<!DOCTYPE html>
<html>
    <head>
        <title>Wizard (should be in Dialog window)</title>
        <script>
            function init(){
                if(window.opener){
                    console.log("window opener is set synchronously")
                    pageLoaded();
                } else {
                    window.addEventListener('message', function(evt){
                        if(evt.data && evt.data.hasOwnProperty('dialog')){
                            if(evt.data.dialog && evt.data.dialog.opener){
                                console.log("window.opener is set asyncronously");
                                pageLoaded();
                            }
                        }
                    }, {once:true});
                }
            }
            function pageLoaded(){
                _printInfo();
            }
            function _printInfo(){
                document.getElementById('openerTitle').textContent = window.opener.location.href;
                document.getElementById('topLocation').textContent = window.top.window.location;
            }
            function destroy() {
                console.log("Opener = ", window.opener);
                if(window.opener) window.opener.document.body.textContent = "I am destroyied!";
            }
            function _findAncestor (el, tag) {
                if(!el || !tag) return null;
                var tagUpperCase = tag.toUpperCase();
                while ((el = el.parentElement) && el.tagName.toUpperCase()!==tagUpperCase);
                debugger;
                return el;
            }
            function amIaDialog() {
                var el = _findAncestor(window.frameElement, 'dialog');
                return el;
            }
            function submitMyForm() {
                document.getElementById("myForm").submit();
            }

            //window['close'] = function () {
            //    console.log('[close]');
            //}
            /*
            Window.prototype.closes = function() {
                //console.log('proto close');
                window.top.postMessage({dialog:null}, '*')
                window.close();
                console.log("I passed")
            }
            */
            /*
            window.close = function (window_close) {
                return function () {
                    // set name if missing here
                    console.log("CLOSE!!!");
                    //return window_close.call(window);
                    window_close.top.postMessage({dialog:null}, '*');
                };
            }(window);//(window.open);
            */
           /*
            window.onbeforeunload = function () {
                // window.opener.alert("test");
                //_close(); 
                debugger;       
                console.log("unloading");
                //return callBack();
            };
            */
        </script>
    </head>
    <body onload="init()">
        <h1>Wizard in the Dialog</h1>
        <article>
            <p>This page is in the iframe. In case you want to close a parent dialog window from the iframe,
                &ndash; send inter-window message to the parent window:
            </p>
            <code style="display:block;">window.parent.postMessage({dialog:null}, '*')</code>
            <hr />
            <button onclick="window.top.postMessage({dialog:null}, '*');">CLOSE WIZARD (postMessage)</button>
            <button onclick="typeof(window._closeup)===typeof(Function)?window._closeup():window.close();">window._closeup() || window.close();</button>
            <button onclick="window.close();">window.close();</button>
            <button onclick="_closeup();">_closeup();</button>
            <button onclick="window.destroy()">destroy() opener</button>
            <hr />
            <button onclick="window.top.postMessage({dialog:{url: window.location.href, size:{width:'50%', height:'80%'}, name: 'wizard'}}, '*');">OPEN WIZARD</button>
            <button onclick="window.top.postMessage({dialog:{url:'https://bing.com', title:'Bing! Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Nulla aliquet enim tortor at. Viverra tellus in hac habitasse platea dictumst vestibulum. Sollicitudin tempor id eu nisl. Fermentum odio eu feugiat pretium. Arcu felis bibendum ut tristique. Vitae congue mauris rhoncus aenean vel. Id diam vel quam elementum pulvinar etiam non quam lacus. Purus gravida quis blandit turpis. Ullamcorper eget nulla facilisi etiam dignissim diam quis enim. Tortor dignissim convallis aenean et tortor at. Sit amet facilisis magna etiam tempor orci eu lobortis.'}}, '*');">Bing</button>
            <button onclick="window.top.postMessage({dialog:{url:'https://bing.com'}});">Bing (no title)</button>
            <form id="myForm" method="GET" action="form-submitted.html">
                <input type="submit" value="Submit form" />
            </form>
            <button onclick="submitMyForm()">Submit with javascript</button>
            <hr />
            <p>We don't close iframe via parent window, because
                they can be in different domains, so <code>window.parent.frames[0].close()</code> won't work in a such case.
            </p>
            <p><button onclick="init();">Get Opener Title</button>: <span id="openerTitle"></span></p>
            <p><button onclick="_printInfo();">window.top.location</button>: <span id="topLocation"></span></p>
            <p>
                <button onclick="document.getElementById('amIaDialog').textContent = !!amIaDialog()">Am I a dialog</button>: <span id="amIaDialog"></span></p>
            <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Nulla aliquet enim tortor at. Viverra tellus in hac habitasse platea dictumst vestibulum. Sollicitudin tempor id eu nisl. Fermentum odio eu feugiat pretium. Arcu felis bibendum ut tristique. Vitae congue mauris rhoncus aenean vel. Id diam vel quam elementum pulvinar etiam non quam lacus. Purus gravida quis blandit turpis. Ullamcorper eget nulla facilisi etiam dignissim diam quis enim. Tortor dignissim convallis aenean et tortor at. Sit amet facilisis magna etiam tempor orci eu lobortis.
            </p>
            <p>
            Netus et malesuada fames ac turpis egestas integer eget. Sit amet purus gravida quis blandit turpis cursus in. Ut venenatis tellus in metus vulputate eu. Consequat id porta nibh venenatis cras sed felis eget. A cras semper auctor neque vitae tempus. Pharetra pharetra massa massa ultricies. Proin fermentum leo vel orci porta non. Ut enim blandit volutpat maecenas volutpat blandit aliquam etiam erat. Egestas sed sed risus pretium quam vulputate. Adipiscing tristique risus nec feugiat in. Gravida dictum fusce ut placerat orci nulla pellentesque dignissim. Integer malesuada nunc vel risus commodo viverra maecenas accumsan lacus. Vulputate ut pharetra sit amet aliquam id diam maecenas ultricies.
            </p>
            <p>
            Ut tortor pretium viverra suspendisse potenti nullam. Leo urna molestie at elementum eu. Dictum fusce ut placerat orci. Pellentesque pulvinar pellentesque habitant morbi tristique senectus. Turpis egestas pretium aenean pharetra magna ac placerat vestibulum. Euismod lacinia at quis risus sed vulputate odio ut. Ut morbi tincidunt augue interdum velit euismod in pellentesque massa. Proin sagittis nisl rhoncus mattis rhoncus. Duis ultricies lacus sed turpis. Mus mauris vitae ultricies leo integer malesuada nunc vel risus.
            </p>
            <p>
            Tincidunt dui ut ornare lectus sit amet. A arcu cursus vitae congue. Sit amet mauris commodo quis imperdiet massa tincidunt nunc pulvinar. Auctor neque vitae tempus quam pellentesque nec nam aliquam. Sit amet consectetur adipiscing elit pellentesque habitant. Urna neque viverra justo nec ultrices dui sapien eget mi. Mauris cursus mattis molestie a iaculis at erat. Egestas quis ipsum suspendisse ultrices gravida dictum fusce ut. Risus nullam eget felis eget. Nibh mauris cursus mattis molestie a iaculis at erat. Est lorem ipsum dolor sit. Ipsum suspendisse ultrices gravida dictum fusce ut placerat. Velit laoreet id donec ultrices tincidunt. Congue quisque egestas diam in arcu. Quam viverra orci sagittis eu volutpat odio facilisis mauris.
            </p>
            <p>
            Auctor eu augue ut lectus. Id porta nibh venenatis cras sed felis eget velit aliquet. Ac tincidunt vitae semper quis lectus nulla at. Neque ornare aenean euismod elementum nisi quis eleifend quam adipiscing. Mi sit amet mauris commodo quis imperdiet massa. Eget aliquet nibh praesent tristique magna sit amet. Nulla facilisi nullam vehicula ipsum. Sollicitudin aliquam ultrices sagittis orci a scelerisque purus semper eget. Vulputate eu scelerisque felis imperdiet proin. Scelerisque eu ultrices vitae auctor eu augue ut lectus.
            </p>
        </article>
        <table>
                <tr>
                    <td>1124</td>
                    <td>gaoiewfabao</td>
                </tr>
                    <td>gaoiewfabao</td>
                </tr>
        </table>
    </body>
</html>