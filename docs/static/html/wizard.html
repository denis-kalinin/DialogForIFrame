<!DOCTYPE html>
<html>
    <head>
        <title>Wizard (should be in Dialog window)</title>
        <script>
            function onPageLoad(){
                _printInfo();
            }
            function _printInfo(){
                document.getElementById('openerTitle').textContent = window.opener.location.href;
                document.getElementById('topLocation').textContent = window.top.location;
            }
            function destroy() {
                console.log("Opener = ", window.opener);
                if(window.opener) window.opener.document.body.textContent = "I am destroyied!";
            }
            function _findAncestor (el, tag) {
                if(!el || !tag) return null;
                var tagUpperCase = tag.toUpperCase();
                while ((el = el.parentElement) && el.tagName.toUpperCase()!==tagUpperCase);
                debugger;
                return el;
            }
            function amIaDialog() {
                var el = _findAncestor(window.frameElement, 'dialog');
                return el;
            }
            function submitMyForm() {
                document.getElementById("myForm").submit();
            }
            function submitMyFormToRedirect() {
                document.getElementById("myFormRedirect").submit();
            }
        </script>
        <script>
            function openDialog(dialogConfig){
                function getTopWindow(checkWindow){
                    if(!checkWindow) checkWindow = window.self;
                    try {if(checkWindow.parent && !checkWindow.parent.noDialog){
                        return getTopWindow(checkWindow.parent);}
                    }catch(e){}
                    return checkWindow;
                }
                getTopWindow().postMessage(dialogConfig, '*');
            }
            function showDocument(url, config){
                function getTopWindow(checkWindow){
                    if(!checkWindow) checkWindow = window.self;
                    try {if(checkWindow.parent && !checkWindow.parent.noDialog){
                        return getTopWindow(checkWindow.parent);}
                    }catch(e){}
                    return checkWindow;
                }
                var targetWindow = getTopWindow();
                var title = (config && congig.title) ? config.title : 'Document';
                var mime = (config && config.mime) ? config.mime : null;
                if(!targetWindow.dialogPolyfill){
                    var script = targetWindow.document.createElement("script");
                    script.setAttribute("src", "topdialog.js");
                    script.addEventListener("load", function(evt){
                        targetWindow.postMessage({
                            downloader:{
                                url: url,
                                title: title,
                                mime: mime,
                                name:'docView',
                                windowName: 'docView_'+ new Date().getTime()
                            }}, '*');
                    });
                    targetWindow.document.head.appendChild(script);
                } else {
                    targetWindow.postMessage({
                        downloader:{
                            url:url,
                            title: title,
                            mime: mime,
                            name:'docView',
                            windowName: 'docView_'+ new Date().getTime()
                        }}, '*');
                }
            }

        </script>
    <script>
        ////// CUT AND PASTE //////////////
  (function(w, loadHandlers){
    function getTopWindow(checkWindow){
        if(!checkWindow) checkWindow = window.self;
        try {if(checkWindow.parent && !checkWindow.parent.noDialog){
            return getTopWindow(checkWindow.parent);}
        }catch(e){}
        return checkWindow;
    }
    function _isDialog(){
        var dialogTag = 'DIALOG', el = w.frameElement || {};
        while( (el=el.parentElement) && el.tagName.toUpperCase()!==dialogTag );
        return !!el;
    }
    var isInDialog = _isDialog();
    var hasOpener = !!w.opener;
    if(isInDialog){
        w.isALDialog = true; //gof's Set mark of dialog to be able use it in comparisons later along with self==top
        if(!w.isDialogCloseable){
            console.debug('self.isDialogCloseable is false. Overriding self.close()');
            w.isDialogCloseable = true;
            var script = w.document.createElement('script');
            script.textContent = "function close(){console.debug('close() is defined by newclose');function getTopWindow(checkWindow){if(!checkWindow) checkWindow = window.self;try {if(checkWindow.parent && !checkWindow.parent.noDialog){return getTopWindow(checkWindow.parent);}}catch(e){}return checkWindow;};getTopWindow().postMessage({dialog:null},'*');}";
            w.document.head.appendChild(script);
        }
    }
    for(var k=0; k<loadHandlers.length; k++){
        var loadHandler = loadHandlers[k];
        if(!loadHandler) throw new Error("\"loadHandler["+k+"]\" is null or undefined. If \"loadHandler\" is a function expression put it somewhere above.");
        if (!loadHandler instanceof Function) throw new Error('loadHandler['+k+'] is not a function.');
        var funcName = loadHandler.name;
        if(!funcName){
            var result = /^function\s+([\w\$]+)\s*\(/.exec( loadHandler.toString() );
            if(!result) throw new Error("Function expression in IE! DECLARE loadHandler: \"function onPageLoad(){...}\", DON'T express like \"var onPageLoad=function(){...}\"");
            funcName = result[1];
        }
        if(isInDialog && !hasOpener){
            (function(funcName, loadHandler){
                console.debug('registered listener for deferred', funcName);
                w.addEventListener('openerset', function(){
                    w[funcName] = function(){
                        console.debug('running deferred', funcName);
                        loadHandler.apply(w);
                    };
                });
                console.debug('Now', funcName, 'is:', window[funcName].toString());
            })(funcName, loadHandler);
        } else {
            console.debug('onload is direct');
            w[funcName] = function(){ loadHandler.apply(w); };
        }
    }
    if(isInDialog && !hasOpener){
        (function(w){
            w.addEventListener('message', function(){
                console.debug('Opener is set, proceed to onload functions');
                w.dispatchEvent(new Event('openerset'));
            }, false);
        })(w);
        console.debug('Request for opener');
        getTopWindow().postMessage({dialog: {update: true}}, '*');
    }
  })(window.self, [onPageLoad]);
        ////// END CUT AND PASTE //////////////
  </script>
    </head>
    <body onload="onPageLoad()">
        <h1>Wizard in the Dialog</h1>
        <article>
            <p>This page is in the iframe. In case you want to close a parent dialog window from the iframe,
                &ndash; send inter-window message to the parent window:
            </p>
            <code style="display:block;">window.parent.postMessage({dialog:null}, '*')</code>
            <hr />
            <button onclick="openDialog({dialog:null});">CLOSE WIZARD (postMessage)</button>
            <button onclick="typeof(window._closeup)===typeof(Function)?window._closeup():window.close();">window._closeup() || window.close();</button>
            <button onclick="window.close();">window.close();</button>
            <button onclick="_closeup();">_closeup();</button>
            <button onclick="window.destroy()">destroy() opener</button>
            <hr />
            <button id="button9" onclick="showDocument('/data?inline=pdf', null);">View PDF</button>
            <button id="button10" onclick="showDocument('/data?inline=docx');">View DOCX</button>
            <hr />
            <button onclick="openDialog({dialog:{url: window.location.href, size:{width:'50%', height:'80%'}, name: 'wizard'}});">OPEN WIZARD</button>
            <button onclick="openDialog({dialog:{url: 'static/html/table.html', size:{width:'50%', height:'80%'}, name: 'table'}});">TABLE</button>
            <button onclick="openDialog({dialog:{url:'https://bing.com', title:'Bing! Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Nulla aliquet enim tortor at. Viverra tellus in hac habitasse platea dictumst vestibulum. Sollicitudin tempor id eu nisl. Fermentum odio eu feugiat pretium. Arcu felis bibendum ut tristique. Vitae congue mauris rhoncus aenean vel. Id diam vel quam elementum pulvinar etiam non quam lacus. Purus gravida quis blandit turpis. Ullamcorper eget nulla facilisi etiam dignissim diam quis enim. Tortor dignissim convallis aenean et tortor at. Sit amet facilisis magna etiam tempor orci eu lobortis.'}});">Bing</button>
            <button onclick="openDialog({dialog:{url:'https://bing.com'}});">Bing (no title)</button>
            <form id="myForm" method="GET" action="form-submitted.html">
                <input type="submit" value="Submit form" />
            </form>
            <button onclick="submitMyForm()">Submit with javascript</button>
            <form id="myFormRedirect" method="GET" action="redirect.html">
                <input type="submit" value="Submit reditected form" />
            </form>
            <button onclick="submitMyFormToRedirect()">Submit to redirect with Javascript</button>
            <hr />
            <p>We don't close iframe via parent window, because
                they can be in different domains, so <code>window.parent.frames[0].close()</code> won't work in a such case.
            </p>
            <p><button onclick="init();">Get Opener Title</button>: <span id="openerTitle"></span></p>
            <p><button onclick="_printInfo();">getTopWindow().location</button>: <span id="topLocation"></span></p>
            <p>
                <button onclick="document.getElementById('amIaDialog').textContent = !!amIaDialog()">Am I a dialog</button>: <span id="amIaDialog"></span></p>
            <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Nulla aliquet enim tortor at. Viverra tellus in hac habitasse platea dictumst vestibulum. Sollicitudin tempor id eu nisl. Fermentum odio eu feugiat pretium. Arcu felis bibendum ut tristique. Vitae congue mauris rhoncus aenean vel. Id diam vel quam elementum pulvinar etiam non quam lacus. Purus gravida quis blandit turpis. Ullamcorper eget nulla facilisi etiam dignissim diam quis enim. Tortor dignissim convallis aenean et tortor at. Sit amet facilisis magna etiam tempor orci eu lobortis.
            </p>
            <p>
            Netus et malesuada fames ac turpis egestas integer eget. Sit amet purus gravida quis blandit turpis cursus in. Ut venenatis tellus in metus vulputate eu. Consequat id porta nibh venenatis cras sed felis eget. A cras semper auctor neque vitae tempus. Pharetra pharetra massa massa ultricies. Proin fermentum leo vel orci porta non. Ut enim blandit volutpat maecenas volutpat blandit aliquam etiam erat. Egestas sed sed risus pretium quam vulputate. Adipiscing tristique risus nec feugiat in. Gravida dictum fusce ut placerat orci nulla pellentesque dignissim. Integer malesuada nunc vel risus commodo viverra maecenas accumsan lacus. Vulputate ut pharetra sit amet aliquam id diam maecenas ultricies.
            </p>
            <p>
            Ut tortor pretium viverra suspendisse potenti nullam. Leo urna molestie at elementum eu. Dictum fusce ut placerat orci. Pellentesque pulvinar pellentesque habitant morbi tristique senectus. Turpis egestas pretium aenean pharetra magna ac placerat vestibulum. Euismod lacinia at quis risus sed vulputate odio ut. Ut morbi tincidunt augue interdum velit euismod in pellentesque massa. Proin sagittis nisl rhoncus mattis rhoncus. Duis ultricies lacus sed turpis. Mus mauris vitae ultricies leo integer malesuada nunc vel risus.
            </p>
            <p>
            Tincidunt dui ut ornare lectus sit amet. A arcu cursus vitae congue. Sit amet mauris commodo quis imperdiet massa tincidunt nunc pulvinar. Auctor neque vitae tempus quam pellentesque nec nam aliquam. Sit amet consectetur adipiscing elit pellentesque habitant. Urna neque viverra justo nec ultrices dui sapien eget mi. Mauris cursus mattis molestie a iaculis at erat. Egestas quis ipsum suspendisse ultrices gravida dictum fusce ut. Risus nullam eget felis eget. Nibh mauris cursus mattis molestie a iaculis at erat. Est lorem ipsum dolor sit. Ipsum suspendisse ultrices gravida dictum fusce ut placerat. Velit laoreet id donec ultrices tincidunt. Congue quisque egestas diam in arcu. Quam viverra orci sagittis eu volutpat odio facilisis mauris.
            </p>
            <p>
            Auctor eu augue ut lectus. Id porta nibh venenatis cras sed felis eget velit aliquet. Ac tincidunt vitae semper quis lectus nulla at. Neque ornare aenean euismod elementum nisi quis eleifend quam adipiscing. Mi sit amet mauris commodo quis imperdiet massa. Eget aliquet nibh praesent tristique magna sit amet. Nulla facilisi nullam vehicula ipsum. Sollicitudin aliquam ultrices sagittis orci a scelerisque purus semper eget. Vulputate eu scelerisque felis imperdiet proin. Scelerisque eu ultrices vitae auctor eu augue ut lectus.
            </p>
        </article>
        <table>
                <tr>
                    <td>1124</td>
                    <td>gaoiewfabao</td>
                </tr>
                    <td>gaoiewfabao</td>
                </tr>
        </table>
    </body>
</html>